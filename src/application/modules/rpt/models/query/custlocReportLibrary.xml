<?xml version="1.0"?>

  <querylibrary>
   <query id="custloc">
     <title>Benificiary Location Gender Report</title>
     <result>
         <tableheader>
            <label>Column Name</label>
	    <label>Beneficiary Code</label>
	    <label>Location id</label>
	    <label>Gender</label>
	    <label>Total Payment Outstanding</label>
	    <label>Total Payment</label>
	    <label>Total Receipt</label>
	    <label>Total Due</label>
	    <label>Total Donation</label>
            <label>BSD Payment</label>	
	    <label>BSD Receipt</label>	
         </tableheader>

         <queryheader>
             <item>COLUMN_NAME</item>
	     <item>CUSTOMER_ID</item>
             <item>LOCATION_ID</item>
             <item>SEX</item>
	     <item>PAYMENT_OUTSTANDING</item>
	     <item>PAYMENT</item>
	     <item>TOTAL_RECEIPT</item>
	     <item>TOTAL_DUE</item>
	     <item>TOTAL_DONATION</item>
             <item>BSD_PAYMENT</item>
             <item>BSD_RECEIPT</item>
         </queryheader>

	 <sqlheadercontent>
		SELECT CONCAT('ZZZZZZZZ','_','Z','_','ZZZZZZ') as 'COLUMN_ORDER' , 'REPORT TOTAL' as 'COLUMN_NAME' , 
		'' as 'CUSTOMER_ID', '' as 'LOCATION_ID', '' as 'SEX', SUM(TOTAL_PAYMENT_PRINCIPAL) AS 'TOTAL_PAYMENT', 
		SUM(TOTAL_RECEIPT_PRINCIPAL) AS 'TOTAL_RECEIPT', SUM(TOTAL_RECEIPT_DUE_PRINCIPAL) AS 'TOTAL_DUE', 
		SUM(TOTAL_RECEIPT_DONATION) AS 'TOTAL_DONATION', SUM(TOTAL_PAYMENT_SECURITY_DEPOSITE) AS 'BSD_PAYMENT', 
		SUM(TOTAL_RECEIPT_SECURITY_DEPOSITE) AS 'BSD_RECEIPT' 
		FROM ltr_trn_summary 
	 </sqlheadercontent>

         <sqlcontent>
		SELECT CONCAT(IFNULL(ent.LOCATION_ID,'XXXXXX'),'_',
		IFNULL(ent.SEX,'X'),'_',IFNULL(ent.CUSTOMER_ID,'XXXXXXX')) as 'COLUMN_ORDER' , 
		'' as 'COLUMN_NAME' , IFNULL(ent.CUSTOMER_ID,'NO CUSTOMER ID') as 'CUSTOMER_ID', 
		IFNULL(ent.LOCATION_ID,'NO LOCATION') as 'LOCATION_ID', IFNULL(ent.SEX,'NO DATA') as 'SEX', 
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @GREATER@ smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT_OUTSTANDING',
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @LESSEQUAL@ smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT',
		SUM(smry.TOTAL_RECEIPT_PRINCIPAL) AS 'TOTAL_RECEIPT', 
		SUM(smry.TOTAL_RECEIPT_DUE_PRINCIPAL) AS 'TOTAL_DUE', SUM(smry.TOTAL_RECEIPT_DONATION) AS 'TOTAL_DONATION', 
		SUM(smry.TOTAL_PAYMENT_SECURITY_DEPOSITE) AS 'BSD_PAYMENT', 
		SUM(smry.TOTAL_RECEIPT_SECURITY_DEPOSITE) AS 'BSD_RECEIPT' , smry.LATEST_DATE 
		FROM ltr_trn_summary AS smry 
		INNER JOIN ref_mst_entity AS ent 
		ON ent.CUSTOMER_ID = smry.CUSTOMER_ID 
		LEFT OUTER JOIN ref_mst_fin_year_info AS fin
		ON fin.STATUS = smry.STATUS
		WHERE smry.STATUS='NORMAL'
		GROUP BY CUSTOMER_ID 
		UNION ALL 
		SELECT CONCAT(IFNULL(ent.LOCATION_ID,'XXXXXX'),'_',IFNULL(ent.SEX,'X'),'_','ZZZZZZZZ') as 'COLUMN_ORDER' , 
		'GENDER LOCATION TOTAL' as 'COLUMN_NAME' , '' as 'CUSTOMER_ID', 
		IFNULL(ent.LOCATION_ID,'NO LOCATION') as 'LOCATION_ID', IFNULL(ent.SEX,'NO DATA') as 'SEX', 
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @GREATER@ smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT_OUTSTANDING',
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @LESSEQUAL@ smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT',
		SUM(smry.TOTAL_RECEIPT_PRINCIPAL) AS 'TOTAL_RECEIPT', 
		SUM(smry.TOTAL_RECEIPT_DUE_PRINCIPAL) AS 'TOTAL_DUE', SUM(smry.TOTAL_RECEIPT_DONATION) AS 'TOTAL_DONATION', 
		SUM(smry.TOTAL_PAYMENT_SECURITY_DEPOSITE) AS 'BSD_PAYMENT', 
		SUM(smry.TOTAL_RECEIPT_SECURITY_DEPOSITE) AS 'BSD_RECEIPT' , smry.LATEST_DATE FROM ltr_trn_summary AS smry 
		INNER JOIN ref_mst_entity AS ent 
		ON ent.CUSTOMER_ID = smry.CUSTOMER_ID 
		LEFT OUTER JOIN ref_mst_fin_year_info AS fin
		ON fin.STATUS = smry.STATUS
		WHERE smry.STATUS='NORMAL'
		GROUP BY ent.LOCATION_ID, ent.SEX 
		UNION ALL 
		SELECT CONCAT(IFNULL(ent.LOCATION_ID,'XXXXXX'),'_','Z','_','ZZZZZZZZ') as 'COLUMN_ORDER' , 
		'LOCATION TOTAL' as 'COLUMN_NAME' , '' as 'CUSTOMER_ID', 
		IFNULL(ent.LOCATION_ID,'NO LOCATION') as 'LOCATION_ID', '' as 'SEX', 
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @GREATER@ smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT_OUTSTANDING',
		SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @LESSEQUAL@   smry.START_DATE,
		smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT',
		SUM(smry.TOTAL_RECEIPT_PRINCIPAL) AS 'TOTAL_RECEIPT', 
		SUM(smry.TOTAL_RECEIPT_DUE_PRINCIPAL) AS 'TOTAL_DUE', SUM(smry.TOTAL_RECEIPT_DONATION) AS 'TOTAL_DONATION', 
		SUM(smry.TOTAL_PAYMENT_SECURITY_DEPOSITE) AS 'BSD_PAYMENT', 
		SUM(smry.TOTAL_RECEIPT_SECURITY_DEPOSITE) AS 'BSD_RECEIPT', smry.LATEST_DATE 
		FROM ltr_trn_summary AS smry 
		INNER JOIN ref_mst_entity AS ent 
		ON ent.CUSTOMER_ID = smry.CUSTOMER_ID 
		LEFT OUTER JOIN ref_mst_fin_year_info AS fin
		ON fin.STATUS = smry.STATUS
		WHERE smry.STATUS='NORMAL'
		GROUP BY ent.LOCATION_ID 
		ORDER BY 1,2		
         </sqlcontent>

	 <footersql>
		<sqlfootercontent>	
			SELECT "REPORT TOTAL" as 'COLUMN_NAME', 
			" " as 'CUSTOMER_ID', 
			" " as 'LOCATION_ID', 
			" " as 'SEX', 
			SUM(parent.PAYMENT_OUTSTANDING) AS 'PAYMENT_OUTSTANDING', 
			SUM(parent.PAYMENT) AS 'PAYMENT', 
			SUM(parent.TOTAL_RECEIPT) AS 'TOTAL_RECEIPT',
			SUM(parent.TOTAL_DUE) AS 'TOTAL_DUE', SUM(parent.TOTAL_DONATION) AS 'TOTAL_DONATION', 
			SUM(parent.BSD_PAYMENT) AS 'BSD_PAYMENT', SUM(parent.BSD_RECEIPT) AS 'BSD_RECEIPT'
			FROM ( 
			SELECT CONCAT(IFNULL(ent.LOCATION_ID,'XXXXXX'),'_',IFNULL(ent.SEX,'X'),'_','ZZZZZZZZ') as 'COLUMN_ORDER' , 
			'GENDER LOCATION TOTAL' as 'COLUMN_NAME' , '' as 'CUSTOMER_ID', 
			IFNULL(ent.LOCATION_ID,'NO LOCATION') as 'LOCATION_ID', IFNULL(ent.SEX,'NO DATA') as 'SEX', 
			SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @GREATER@ smry.START_DATE,
			smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT_OUTSTANDING',
			SUM(IF(DATE(CONCAT(fin.FIN_YEAR_START,'-',fin.FIN_YEAR_START_MONTH,'-',fin.FIN_YEAR_START_DAY)) @LESSEQUAL@   smry.START_DATE,
			smry.TOTAL_PAYMENT_PRINCIPAL,0)) AS 'PAYMENT',
			SUM(smry.TOTAL_RECEIPT_PRINCIPAL) AS 'TOTAL_RECEIPT', 
			SUM(smry.TOTAL_RECEIPT_DUE_PRINCIPAL) AS 'TOTAL_DUE', SUM(smry.TOTAL_RECEIPT_DONATION) AS 'TOTAL_DONATION', 
			SUM(smry.TOTAL_PAYMENT_SECURITY_DEPOSITE) AS 'BSD_PAYMENT', 
			SUM(smry.TOTAL_RECEIPT_SECURITY_DEPOSITE) AS 'BSD_RECEIPT',smry.LATEST_DATE FROM ltr_trn_summary AS smry 
			INNER JOIN ref_mst_entity AS ent 
			ON ent.CUSTOMER_ID = smry.CUSTOMER_ID
			LEFT OUTER JOIN ref_mst_fin_year_info AS fin
			ON fin.STATUS = smry.STATUS
			GROUP BY ent.LOCATION_ID, ent.SEX 
			) parent WHERE 1=1 AND parent.LOCATION_ID LIKE ':param1' 
			AND parent.SEX LIKE ':param2' 
			GROUP BY COLUMN_NAME
		</sqlfootercontent>
	 </footersql>
         
         <patinatorconditions>
            <pages>20</pages>
            <rowsperpage>20</rowsperpage>
         </patinatorconditions>

     </result>

     <criteria>
         <searchparams>  
            
            <searchitem>
                 <searchparam>Y</searchparam>
                 <name>locid</name>
		 <class>location</class>
                 <columnvalue>LOCATION_ID</columnvalue>
                 <conditiontype>@PATTERN@</conditiontype>
                 <label>Location Code</label>
                 <isdisplay>Y</isdisplay>
                 <order>1</order>
                 <datatype>CHAR</datatype>
                 <displaytype>TEXT</displaytype>
                 <length>20</length>
             </searchitem>

	     <searchitem>
                 <searchparam>Y</searchparam>
                 <name>gender</name>
                 <columnvalue>SEX</columnvalue>
		 <conditiontype>@EQUAL@</conditiontype>
                 <label>Gender</label>
                 <isdisplay>Y</isdisplay>
                 <order>1</order>
                 <datatype>CHAR</datatype>
                 <displaytype>RADIO</displaytype>
		 <sqlbundle>
			<sqlcontent>
				SELECT VALUE_ID,VALUE_NAME FROM ref_sta_key_value
				WHERE KEY_ID ='Gender'
			</sqlcontent>
			<label>VALUE_NAME</label>
			<value>VALUE_ID</value>
		 </sqlbundle>
             </searchitem>

	     <searchitem>
                 <searchparam>Y</searchparam>
                 <name>col</name>
                 <columnvalue>COLUMN_NAME</columnvalue>
		 <conditiontype>@LIKE@</conditiontype>
                 <label>Column Name</label>
                 <isdisplay>Y</isdisplay>
		 <extend>OR parent.COLUMN_NAME = 'REPORT TOTAL'</extend>
                 <order>3</order>
                 <datatype>CHAR</datatype>
                 <displaytype>DROPDOWN</displaytype>
		 <values>
			<label>Select</label>
			<value></value>

			<label>LOCATION TOTAL</label>
			<value>LOCATION TOTAL</value>

			<label>GENDER LOCATION TOTAL</label>
			<value>GENDER LOCATION TOTAL</value>
		</values>
	     </searchitem>
	     
	     <searchitem>
                 <isdisplay>N</isdisplay>
                 <order>5</order>
                 <displaytype>BLANK</displaytype>
             </searchitem>

             <searchitem>
                 <name>Search</name>
                 <isdisplay>Y</isdisplay>
                 <order>6</order>
                 <id>submit</id>
                 <datatype>CHAR</datatype>
                 <displaytype>SUBMIT</displaytype>
                 <value>Search</value>
             </searchitem>

        </searchparams>
     </criteria>

   </query>
   </querylibrary> 


